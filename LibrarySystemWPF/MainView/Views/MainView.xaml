<Window x:Class="LibrarySystemWPF.MainView.Views.MainView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:viewModel="clr-namespace:LibrarySystemWPF.MainView.ViewModels"
        xmlns:componentModel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        Title="Bibliothek" Height="500" Width="1050" ResizeMode="CanMinimize"
        WindowState="Normal"
        WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <viewModel:MainViewModel />
    </Window.DataContext>
    
    <Grid>
        <TabControl>
            <TabItem Header="Bücher">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    
                    <Button HorizontalAlignment="Right" VerticalAlignment="Top" Height="Auto" Width="Auto" Content="Reload" Margin="0,15,15,0" Command="{Binding SyncCommand}"/>

                    <StackPanel Orientation="Horizontal" Grid.Row="0">
                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Title:" />
                            <TextBox Text="{Binding NewBook.Title}" Width="120" Height="22" />
                        </StackPanel>

                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Subject:" />
                            <ComboBox ItemsSource="{Binding SubjectValues}"
                                      SelectedValue="{Binding NewBook.Subject}" Height="22" />
                        </StackPanel>

                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Isbn:" />
                            <TextBox Text="{Binding NewBook.Isbn}" Width="80" Height="22" />
                        </StackPanel>

                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Autor:" />

                            <ComboBox ItemsSource="{Binding Authors}"
                                      DisplayMemberPath="FullName"
                                      IsEditable="True"
                                      Height="22"
                                      Width="80"
                                      SelectedItem="{Binding NewBook.Author}"
                                      Text="{Binding NewBook.AuthorPlaceholder, UpdateSourceTrigger=PropertyChanged}">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="LostKeyboardFocus">
                                        <i:InvokeCommandAction Command="{Binding AddAuthorCommand}"
                                                               CommandParameter="{Binding Text, RelativeSource={RelativeSource AncestorType=ComboBox}}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Verlag:" />

                            <ComboBox ItemsSource="{Binding Publishers}"
                                      DisplayMemberPath="Name"
                                      IsEditable="True"
                                      Height="22"
                                      Width="80"
                                      SelectedItem="{Binding NewBook.Publisher}"
                                      Text="{Binding NewBook.PublisherPlaceholder, UpdateSourceTrigger=PropertyChanged}">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="LostKeyboardFocus">
                                        <i:InvokeCommandAction Command="{Binding AddPublisherCommand}"
                                                               CommandParameter="{Binding Text, RelativeSource={RelativeSource AncestorType=ComboBox}}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Veröffentlichung:" />
                            <DatePicker Height="22"
                                        SelectedDate="{Binding NewBook.PublishDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>
                        
                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="Kennung:" />
                            <TextBox Text="{Binding NewBook.InternId}" Width="85" Height="22" />
                        </StackPanel>

                        <Button Content="Hinzufügen"
                                Command="{Binding AddBookCommand}"
                                CommandParameter="{Binding NewBook}"
                                Height="22"
                                Margin="8,10,0,10" />
                    </StackPanel>

                    <TextBox Grid.Row="1"
                             Margin="0,8,0,8"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

                    <ListView Grid.Row="2" ItemsSource="{Binding Books}">
                        <ListView.View>
                            <GridView AllowsColumnReorder="true">
                                <GridViewColumn DisplayMemberBinding="{Binding InternId}" Header="Kennung" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Title}" Header="Title" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Subject}" Header="Themengebiet" Width="Auto"/>
                                <GridViewColumn DisplayMemberBinding="{Binding Isbn}" Header="Isbn" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Author.FullName}" Header="Autor Name"
                                                Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Publisher.Name}" Header="Verlag Name"
                                                Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Publisher.Location}"
                                                Header="Verlag Herkunft" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding PublishDate, StringFormat=dd.MM.yyyy}"
                                                Header="Veröffentlichung" Width="Auto" />
                                <GridViewColumn Header="Verleihen" Width="Auto">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Ausleihen"
                                                    Command="{Binding DataContext.BorrowCommand,
                          RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=Content}"/>


                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Löschen" Width="Auto">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Löschen"
                                                    Command="{Binding DataContext.DeleteBookCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}" IsEnabled="{Binding }">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="IsEnabled" Value="True"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsBorrowed}" Value="True">
                                                                <Setter Property="IsEnabled" Value="False"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </TabItem>

            <TabItem Header="Schüler">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    
                    <Button HorizontalAlignment="Right" VerticalAlignment="Top" Height="Auto" Width="Auto" Content="Reload" Margin="0,15,15,0" Command="{Binding SyncCommand}"/>

                    <StackPanel Orientation="Horizontal" Grid.Row="0">
                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Ausweisnummer:" />
                            <TextBox Text="{Binding NewPerson.IdNumber}" Width="120" Height="22" />
                        </StackPanel>
                        
                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Vorname:" />
                            <TextBox Text="{Binding NewPerson.FirstName}" Width="120" Height="22" />
                        </StackPanel>
                        
                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Nachname:" />
                            <TextBox Text="{Binding NewPerson.LastName}" Width="120" Height="22" />
                        </StackPanel>
                        
                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Telefonnummer:" />
                            <TextBox Text="{Binding NewPerson.Phone}" Width="120" Height="22" />
                        </StackPanel>
                        
                        <StackPanel Margin="5,5,5,0">
                            <TextBlock Text="*Addresse:" />
                            <TextBox Text="{Binding NewPerson.Address}" Width="120" Height="22" />
                        </StackPanel>
                        
                        <Button Content="Hinzufügen"
                                Command="{Binding AddPersonCommand}"
                                CommandParameter="{Binding NewPerson}"
                                Height="22"
                                Margin="8,10,0,10" />
                    </StackPanel>

                    <TextBox
                        Grid.Row="1"
                        Margin="0,8,0,8"
                        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

                    <ListView Grid.Row="2" ItemsSource="{Binding Persons}">
                        <ListView.View>
                            <GridView AllowsColumnReorder="true">
                                <GridViewColumn DisplayMemberBinding="{Binding IdNumber}" Header="Ausweisnummer"
                                                Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding FirstName}" Header="Vorname" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding LastName}" Header="Nachname" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Phone}" Header="Telefon" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Address}" Header="Adresse" Width="Auto" />
                                <GridViewColumn Header="Löschen" Width="Auto">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Löschen"
                                                    Command="{Binding DataContext.DeletePersonCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>

                </Grid>

            </TabItem>
            
            <TabItem Header="Verleihungen">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    
                    <Button HorizontalAlignment="Right" VerticalAlignment="Top" Height="Auto" Width="Auto" Content="Reload" Margin="0,15,15,0" Command="{Binding SyncCommand}"/>

                    <TextBox
                        Grid.Row="1"
                        Margin="0,8,0,8"
                        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

                    <ListView Grid.Row="2">
                        <ListView.Resources>
                            <CollectionViewSource x:Key="BorrowsView"
                                                  Source="{Binding Borrows}">
                                <CollectionViewSource.SortDescriptions>
                                    <componentModel:SortDescription PropertyName="IsReturned"
                                                     Direction="Ascending" />
                                    <componentModel:SortDescription PropertyName="ReturnDate"
                                                     Direction="Ascending" />
                                </CollectionViewSource.SortDescriptions>
                            </CollectionViewSource>
                        </ListView.Resources>
                        
                        <ListView.ItemsSource>
                            <Binding Source="{StaticResource BorrowsView}" />
                        </ListView.ItemsSource>
                        
                        <ListView.View>
                            <GridView AllowsColumnReorder="true">
                                <GridViewColumn DisplayMemberBinding="{Binding Person.FullName}" Header="Person" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Book.InternId}" Header="Buch Kennung" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding Book.Title}" Header="Buch Name" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding BorrowDate, StringFormat=dd.MM.yyyy hh:mm}" Header="Verleih Datum" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding ReturnDate, StringFormat=dd.MM.yyyy hh:mm}" Header="Rückgabe Datum" Width="Auto" />
                                <GridViewColumn DisplayMemberBinding="{Binding LatestReturnDate, StringFormat=dd.MM.yyyy hh:mm}" Header="spätestes zurückgabe Datum" Width="Auto" />
                                <GridViewColumn Header="Zurückgegeben" Width="Auto">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Zurückgegeben"
                                                    Command="{Binding DataContext.ReturnBookCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>